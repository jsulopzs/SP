---
title: "Hypothesis Testing in R"
output:
  word_document: default
  html_document: default
---

# Hypothesis Testing

This document covers hypothesis testing based on relationships between variables of different types using R. We will perform:

- **Numerical & Categorical**: Testing differences in numerical data across categorical groups.
- **Categorical & Categorical**: Using Chi-squared tests to explore relationships between categorical variables.
- **Numerical & Numerical**: Applying Pearson's correlation to understand relationships between two numerical variables.

We'll use different datasets and R libraries such as `ggplot2` for visualization and `stats` for statistical testing.

---

## Setup
Let's begin by loading the required libraries:

```{r}
# Load required libraries
library(dplyr)
library(ggplot2)
library(readr)
```

---

## Numerical & Categorical

### T-test: 1 Categorical with 2 Groups

We will explore whether there is a significant difference in salaries between two cities, **Madrid** and **Barcelona**.

### Data Loading and Exploration

First, load the data:

```{r}
df_salaries <- read_csv("../../data/salaries2.csv")
df_salaries
```

### Summarize the Data

We group the data by city and calculate the mean salary for each city:

```{r}
df_salaries %>%
  group_by(city) %>%
  summarize(mean_salary = mean(yearly_salary_k))
```

### Visualize the Data

Use `ggplot2` to visualize the distribution of salaries by city:

```{r}
ggplot(df_salaries, aes(x = city, y = yearly_salary_k, fill = city)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Salary Distribution by City", x = "City", y = "Yearly Salary (K)")
```

### Validate the Hypothesis Statistically

To test if the salary difference between **Madrid** and **Barcelona** is statistically significant, we perform a t-test:

```{r}
t.test(yearly_salary_k ~ city, data = df_salaries, conf.level = 0.95)
```

---

### ANOVA: 1 Categorical with > 2 Groups

Now, we add data from **Bilbao** and perform ANOVA to compare salaries across all three cities.

### Data Loading and Exploration

```{r}
df_salaries <- read_csv("../../data/salaries3.csv")
df_salaries
```

### Summarize the Data

We calculate the mean and variance of salaries by city:

```{r}
df_salaries %>%
  group_by(city) %>%
  summarize(mean_salary = mean(yearly_salary_k), var_salary = var(yearly_salary_k))
```

### Visualize the Data

Plot a boxplot to visualize salary distribution across the three cities:

```{r}
ggplot(df_salaries, aes(x = city, y = yearly_salary_k, fill = city)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Salary Distribution by City", x = "City", y = "Yearly Salary (K)")
```

### Validate the Hypothesis Statistically

We perform an ANOVA test to check if there is a significant difference in salaries across the three cities:

```{r}
aov_res <- aov(yearly_salary_k ~ city, data = df_salaries)
summary(aov_res)
```

```{r}
TukeyHSD(aov_res)
```

---

## Chi-squared Test: Categorical & Categorical

Next, we examine whether there is a relationship between passenger class and survival status in the Titanic dataset.

### Data Loading and Exploration

Load the Titanic dataset:

```{r}
df_titanic <- read.csv("../../data/titanic.csv")
df_titanic
```

### Summarize the Data

We create a frequency table of survival status by passenger class:

```{r}
titanic_summary <- df_titanic %>%
  group_by(alive, class) %>%
  summarize(freq = n())

titanic_summary
```

### Visualize the Data

We create bar and pie charts to visualize survival by class:

#### Bar plot

```{r}
ggplot(titanic_summary, aes(x = alive, y = freq, fill = class)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Survival by Passenger Class", x = "Survival", y = "Frequency")
```


#### Pie plot

```{r}
ggplot(titanic_summary, aes(x = "", y = freq, fill = class)) +
  geom_bar(stat = "identity") +
  coord_polar("y") +
  facet_wrap(~ alive) +
  labs(title = "Survival Distribution by Class")
```

### Validate the Hypothesis Statistically

We perform a Chi-squared test to check if there is a relationship between survival and class:

```{r}
table_contingency <- table(df_titanic$alive, df_titanic$class)
table_contingency
```


```{r}
chisq_test <- chisq.test(table_contingency)
chisq_test
```

---

## Pearson's Correlation: Numerical & Numerical

Lastly, we explore the relationship between goals scored and points earned in the Premier League.

### Data Loading and Exploration

Load the Premier League dataset:

```{r}
library(readxl)

df_premier <- read_excel("../../data/premier_league.xlsx")
df_premier
```

```{r}
library(tibble)

df_premier <- column_to_rownames(df_premier, var = "team")
df_premier
```

### Summarize the Data

We calculate the correlation matrix for the dataset:

```{r}
cor(df_premier)
```

### Visualize the Data

We create a scatterplot to visualize the relationship between goals and points:

```{r}
ggplot(df_premier, aes(x = goals, y = points)) +
  geom_point() +
  theme_minimal() +
  geom_smooth(method = 'lm') +
  labs(title = "Goals vs Points in Premier League", x = "Goals", y = "Points")
```

### Validate the Hypothesis Statistically

We calculate Pearson's correlation coefficient between goals and points:

```{r}
cor.test(df_premier$goals, df_premier$points)
```

--- 

This concludes our analysis of hypothesis testing across different variable types using R.